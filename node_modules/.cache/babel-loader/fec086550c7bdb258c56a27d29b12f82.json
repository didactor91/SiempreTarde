{"ast":null,"code":"import _slicedToArray from \"/Users/didactor/Documents/skylab/bootcamp/collab/skylab-bootcamp-201904/staff/groups/aldi/siempre-tarde/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport normalize from '../common/normalize';\nimport validate from '../common/validate';\nimport userApi from '../data/user-api';\nimport { LogicError, DirectionError, PasswordError, NoDataError } from '../common/errors';\nimport iBusApi from '../data/ibus-api';\nimport transitApi from '../data/transit-api';\nconst logic = {\n  set __userId__(id) {\n    sessionStorage.userId = id;\n  },\n\n  get __userId__() {\n    return normalize.undefinedOrNull(sessionStorage.userId);\n  },\n\n  set __userToken__(token) {\n    sessionStorage.userToken = token;\n  },\n\n  get __userToken__() {\n    return normalize.undefinedOrNull(sessionStorage.userToken);\n  },\n\n  get isUserLoggedIn() {\n    return !!(this.__userId__ && this.__userToken__);\n  },\n\n  registerUser(name, surname, email, password, password2) {\n    validate.arguments([{\n      name: 'name',\n      value: name,\n      type: 'string',\n      notEmpty: true\n    }, {\n      name: 'surname',\n      value: surname,\n      type: 'string',\n      notEmpty: true\n    }, {\n      name: 'email',\n      value: email,\n      type: 'string',\n      notEmpty: true\n    }, {\n      name: 'password',\n      value: password,\n      type: 'string',\n      notEmpty: true\n    }, {\n      name: 'password2',\n      value: password2,\n      type: 'string',\n      notEmpty: true\n    }]);\n    validate.email(email);\n    if (password !== password2) throw new PasswordError(\"Password don't match\");\n    return userApi.create(email, password, {\n      name,\n      surname\n    }).then(response => {\n      if (response.status === 'OK') return;\n      throw new LogicError(response.error);\n    });\n  },\n\n  loginUser(email, password) {\n    validate.arguments([{\n      name: 'email',\n      value: email,\n      type: 'string',\n      notEmpty: true\n    }, {\n      name: 'password',\n      value: password,\n      type: 'string',\n      notEmpty: true\n    }]);\n    validate.email(email);\n    return userApi.authenticate(email, password).then(response => {\n      if (response.status === 'OK') {\n        const _response$data = response.data,\n              id = _response$data.id,\n              token = _response$data.token;\n        this.__userId__ = id;\n        this.__userToken__ = token;\n      } else throw new LogicError(response.error);\n    });\n  },\n\n  retrieveUser() {\n    return userApi.retrieve(this.__userId__, this.__userToken__).then(response => {\n      if (response.status === 'OK') {\n        const _response$data2 = response.data,\n              name = _response$data2.name,\n              surname = _response$data2.surname,\n              email = _response$data2.username;\n        return {\n          name,\n          surname,\n          email\n        };\n      } else throw new LogicError(response.error);\n    });\n  },\n\n  logoutUser() {\n    sessionStorage.clear();\n  },\n\n  addFavorites() {//TODO\n  },\n\n  retrieveFavorites() {//TODO\n  },\n\n  retrieveBusLines(line_id) {\n    validate.arguments([{\n      name: 'line_id',\n      value: line_id,\n      type: 'number',\n      notEmpty: true,\n      optional: true\n    }]);\n    return transitApi.retrieveBusLine(line_id).then(response => {\n      const features = response.features;\n      return features.map(({\n        properties: {\n          \"CODI_LINIA\": line_id,\n          \"NOM_LINIA\": name_line,\n          \"DESC_LINIA\": desc_line,\n          \"ORIGEN_LINIA\": origin_line,\n          \"DESTI_LINIA\": dest_line,\n          \"COLOR_LINIA\": color_line\n        }\n      }) => {\n        return {\n          line_id,\n          name_line,\n          desc_line,\n          origin_line,\n          dest_line,\n          color_line\n        };\n      });\n    });\n  },\n\n  retrieveBusLineRoute(line_id) {\n    validate.arguments([{\n      name: 'line_id',\n      value: line_id,\n      type: 'number',\n      notEmpty: true,\n      optional: false\n    }]);\n    return transitApi.retrieveBusLineRoute(line_id).then(response => {\n      const features = response.features;\n      return features.map(({\n        properties: {\n          \"SENTIT\": direction_id,\n          \"DESTI_SENTIT\": direction_name\n        }\n      }) => {\n        return {\n          direction_id,\n          direction_name\n        };\n      });\n    });\n  },\n\n  retrieveBusStops(line_id, direction_id) {\n    validate.arguments([{\n      name: 'line_id',\n      value: line_id,\n      type: 'number',\n      notEmpty: true,\n      optional: false\n    }, {\n      name: 'direction_id',\n      value: direction_id,\n      type: 'string',\n      notEmpty: true,\n      optional: false\n    }]);\n\n    if (direction_id !== 'A' && direction_id !== 'T') {\n      throw new DirectionError('direction is not valid');\n    }\n\n    return transitApi.retrieveBusStops(line_id).then(response => {\n      const features = response.features;\n      let stops = [];\n      features.forEach(e => {\n        const _e$properties = e.properties,\n              stop_id = _e$properties[\"CODI_PARADA\"],\n              stop_name = _e$properties[\"NOM_PARADA\"],\n              direction = _e$properties[\"SENTIT\"];\n\n        if (direction === direction_id) {\n          stops.push({\n            stop_id,\n            stop_name\n          });\n        }\n      });\n      return stops;\n    });\n  },\n\n  upcomingBusesByStop(stop_id) {\n    validate.arguments([{\n      name: 'stop',\n      value: stop_id,\n      type: 'number',\n      notEmpty: true,\n      optional: false\n    }]);\n    let buses = [];\n    let stop_name = '';\n    return transitApi.retrieveStop(stop_id).then(response => {\n      const _response$features = _slicedToArray(response.features, 1),\n            _stop_name = _response$features[0].properties[\"NOM_PARADA\"];\n\n      stop_name = _stop_name;\n      return iBusApi.retrieveStopId(stop_id);\n    }).then(response => {\n      const ibus = response.data.ibus;\n      if (ibus.length === 0) throw new NoDataError('no data recived');\n      return ibus.map((bus, index) => {\n        const line = bus.line,\n              t_in_min = bus[\"t-in-min\"],\n              t_in_s = bus[\"t-in-s\"],\n              text_ca = bus[\"text-ca\"];\n        buses[index] = {\n          line,\n          t_in_min,\n          t_in_s,\n          text_ca\n        };\n        return transitApi.retrieveBusLine();\n      });\n    }).then(res => Promise.all(res).then(response => {\n      return response.map(({\n        features\n      }) => {\n        return features.map(({\n          properties: {\n            \"CODI_LINIA\": line_id,\n            \"NOM_LINIA\": name_line,\n            \"DESC_LINIA\": desc_line,\n            \"ORIGEN_LINIA\": origin_line,\n            \"DESTI_LINIA\": dest_line,\n            \"COLOR_LINIA\": color_line\n          }\n        }) => {\n          return {\n            line_id,\n            name_line,\n            desc_line,\n            origin_line,\n            dest_line,\n            color_line\n          };\n        });\n      });\n    })).then(resp => {\n      let upcomingBuses = [];\n      resp.map((arr, index) => {\n        let lineFind = false;\n        let i = 0;\n        let color_line = '#000000';\n        let dest_line = '';\n        let name_line = '';\n        let desc_line = '';\n        let origin_line = '';\n\n        while (i < arr.length && !lineFind) {\n          if (arr[i].name_line === buses[index].line) {\n            color_line = arr[i].color_line;\n            dest_line = arr[i].dest_line;\n            name_line = arr[i].name_line;\n            desc_line = arr[i].desc_line;\n            origin_line = arr[i].origin_line;\n            lineFind = true;\n          } else {\n            i++;\n          }\n        }\n\n        upcomingBuses.push({\n          line: buses[index].line,\n          t_in_min: buses[index].t_in_min,\n          t_in_s: buses[index].t_in_s,\n          text_ca: buses[index].text_ca,\n          color_line,\n          dest_line,\n          name_line,\n          desc_line,\n          origin_line,\n          stop_id,\n          stop_name: stop_name\n        });\n      });\n      return upcomingBuses;\n    });\n  },\n\n  upcomingBusesByStopAndLine(stop_id, line_id) {\n    validate.arguments([{\n      name: 'stop',\n      value: stop_id,\n      type: 'number',\n      notEmpty: true,\n      optional: false\n    }, {\n      name: 'line',\n      value: line_id,\n      type: 'number',\n      notEmpty: true,\n      optional: false\n    }]);\n    let buses = [];\n    let upcomingBuses = [];\n    return iBusApi.retrieveLineId(stop_id, line_id).then(response => {\n      const ibus = response.data.ibus;\n      if (ibus.length === 0) throw new NoDataError('no data recived');\n      return ibus.map((bus, index) => {\n        const t_in_min = bus[\"t-in-min\"],\n              t_in_s = bus[\"t-in-s\"],\n              text_ca = bus[\"text-ca\"];\n        buses[index] = {\n          line_id,\n          t_in_min,\n          t_in_s,\n          text_ca\n        };\n        return transitApi.retrieveBusLine(line_id);\n      });\n    }).then(res => Promise.all(res).then(response => {\n      return response.map(({\n        features\n      }) => {\n        return features.map(({\n          properties: {\n            \"CODI_LINIA\": line_id,\n            \"NOM_LINIA\": name_line,\n            \"DESC_LINIA\": desc_line,\n            \"ORIGEN_LINIA\": origin_line,\n            \"DESTI_LINIA\": dest_line,\n            \"COLOR_LINIA\": color_line\n          }\n        }) => {\n          return {\n            line_id,\n            name_line,\n            desc_line,\n            origin_line,\n            dest_line,\n            color_line\n          };\n        });\n      });\n    })).then(resp => {\n      resp.map(arr => {\n        upcomingBuses.push({\n          line: buses[0].line_id,\n          t_in_min: buses[0].t_in_min,\n          t_in_s: buses[0].t_in_s,\n          text_ca: buses[0].text_ca,\n          color_line: arr[0].color_line,\n          dest_line: arr[0].dest_line,\n          name_line: arr[0].name_line,\n          desc_line: arr[0].desc_line,\n          origin_line: arr[0].origin_line\n        });\n      });\n      return transitApi.retrieveStop(stop_id);\n    }).then(response => {\n      let busesData = [];\n\n      const _response$features2 = _slicedToArray(response.features, 1),\n            _response$features2$ = _response$features2[0].properties,\n            _stop_id = _response$features2$[\"CODI_PARADA\"],\n            _stop_name = _response$features2$[\"NOM_PARADA\"];\n\n      busesData.push({\n        line: upcomingBuses[0].line,\n        t_in_min: upcomingBuses[0].t_in_min,\n        t_in_s: upcomingBuses[0].t_in_s,\n        text_ca: upcomingBuses[0].text_ca,\n        color_line: upcomingBuses[0].color_line,\n        dest_line: upcomingBuses[0].dest_line,\n        name_line: upcomingBuses[0].name_line,\n        desc_line: upcomingBuses[0].desc_line,\n        origin_line: upcomingBuses[0].origin_line,\n        stop_id: _stop_id,\n        stop_name: _stop_name\n      });\n      return busesData;\n    });\n  }\n\n};\nexport default logic;","map":{"version":3,"sources":["/Users/didactor/Documents/skylab/bootcamp/collab/skylab-bootcamp-201904/staff/groups/aldi/siempre-tarde/src/logic/index.js"],"names":["normalize","validate","userApi","LogicError","DirectionError","PasswordError","NoDataError","iBusApi","transitApi","logic","__userId__","id","sessionStorage","userId","undefinedOrNull","__userToken__","token","userToken","isUserLoggedIn","registerUser","name","surname","email","password","password2","arguments","value","type","notEmpty","create","then","response","status","error","loginUser","authenticate","data","retrieveUser","retrieve","username","logoutUser","clear","addFavorites","retrieveFavorites","retrieveBusLines","line_id","optional","retrieveBusLine","features","map","properties","name_line","desc_line","origin_line","dest_line","color_line","retrieveBusLineRoute","direction_id","direction_name","retrieveBusStops","stops","forEach","e","stop_id","stop_name","direction","push","upcomingBusesByStop","buses","retrieveStop","_stop_name","retrieveStopId","ibus","length","bus","index","line","t_in_min","t_in_s","text_ca","res","Promise","all","resp","upcomingBuses","arr","lineFind","i","upcomingBusesByStopAndLine","retrieveLineId","busesData","_stop_id"],"mappings":"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","sourcesContent":["import normalize from '../common/normalize'\nimport validate from '../common/validate'\nimport userApi from '../data/user-api'\nimport { LogicError, DirectionError, PasswordError, NoDataError } from '../common/errors'\nimport iBusApi from '../data/ibus-api'\nimport transitApi from '../data/transit-api'\n\n\n\nconst logic = {\n\n    set __userId__(id) {\n        sessionStorage.userId = id\n    },\n\n    get __userId__() {\n        return normalize.undefinedOrNull(sessionStorage.userId)\n    },\n\n    set __userToken__(token) {\n        sessionStorage.userToken = token\n    },\n\n    get __userToken__() {\n        return normalize.undefinedOrNull(sessionStorage.userToken)\n    },\n\n    get isUserLoggedIn() {\n        return !!(this.__userId__ && this.__userToken__)\n    },\n\n    registerUser(name, surname, email, password, password2) {\n\n        validate.arguments([\n            { name: 'name', value: name, type: 'string', notEmpty: true },\n            { name: 'surname', value: surname, type: 'string', notEmpty: true },\n            { name: 'email', value: email, type: 'string', notEmpty: true },\n            { name: 'password', value: password, type: 'string', notEmpty: true },\n            { name: 'password2', value: password2, type: 'string', notEmpty: true }\n        ])\n\n        validate.email(email)\n\n        if (password !== password2) throw new PasswordError(\"Password don't match\")\n\n        return userApi.create(email, password, { name, surname })\n            .then(response => {\n                if (response.status === 'OK') return\n\n                throw new LogicError(response.error)\n            })\n    },\n\n    loginUser(email, password) {\n        validate.arguments([\n            { name: 'email', value: email, type: 'string', notEmpty: true },\n            { name: 'password', value: password, type: 'string', notEmpty: true }\n        ])\n\n        validate.email(email)\n\n        return userApi.authenticate(email, password)\n            .then(response => {\n                if (response.status === 'OK') {\n                    const { data: { id, token } } = response\n\n                    this.__userId__ = id\n                    this.__userToken__ = token\n                } else throw new LogicError(response.error)\n            })\n    },\n\n    retrieveUser() {\n        return userApi.retrieve(this.__userId__, this.__userToken__)\n            .then(response => {\n                if (response.status === 'OK') {\n                    const { data: { name, surname, username: email } } = response\n\n                    return { name, surname, email }\n                } else throw new LogicError(response.error)\n            })\n    },\n\n    logoutUser() {\n        sessionStorage.clear()\n    },\n\n\n    addFavorites() {\n        //TODO\n    },\n\n\n    retrieveFavorites() {\n        //TODO\n    },\n\n\n    retrieveBusLines(line_id) {\n\n        validate.arguments([\n            { name: 'line_id', value: line_id, type: 'number', notEmpty: true, optional: true }\n        ])\n\n        return transitApi.retrieveBusLine(line_id)\n            .then(response => {\n                const { features } = response\n\n                return features.map(({ properties:\n                    { \"CODI_LINIA\": line_id,\n                        \"NOM_LINIA\": name_line,\n                        \"DESC_LINIA\": desc_line,\n                        \"ORIGEN_LINIA\": origin_line,\n                        \"DESTI_LINIA\": dest_line,\n                        \"COLOR_LINIA\": color_line\n                    }\n                }) => {\n                    return { line_id, name_line, desc_line, origin_line, dest_line, color_line }\n                })\n            })\n    },\n\n\n    retrieveBusLineRoute(line_id) {\n\n        validate.arguments([\n            { name: 'line_id', value: line_id, type: 'number', notEmpty: true, optional: false }\n        ])\n\n        return transitApi.retrieveBusLineRoute(line_id)\n            .then(response => {\n                const { features } = response\n\n                return features.map(({ properties:\n                    { \"SENTIT\": direction_id,\n                        \"DESTI_SENTIT\": direction_name\n                    }\n                }) => {\n                    return { direction_id, direction_name }\n                })\n            })\n    },\n\n\n    retrieveBusStops(line_id, direction_id) {\n\n        validate.arguments([\n            { name: 'line_id', value: line_id, type: 'number', notEmpty: true, optional: false },\n            { name: 'direction_id', value: direction_id, type: 'string', notEmpty: true, optional: false }\n        ])\n\n        if (direction_id !== 'A' && direction_id !== 'T') { throw new DirectionError('direction is not valid') }\n\n\n        return transitApi.retrieveBusStops(line_id)\n            .then(response => {\n                const { features } = response\n\n                let stops = []\n\n                features.forEach(e => {\n                    const { properties:\n                        { \"CODI_PARADA\": stop_id,\n                            \"NOM_PARADA\": stop_name,\n                            \"SENTIT\": direction\n                        }\n                    } = e\n                    if (direction === direction_id) {\n                        stops.push({ stop_id, stop_name })\n                    }\n\n                })\n\n                return stops\n            })\n    },\n\n   upcomingBusesByStop(stop_id) {\n\n    validate.arguments([\n        { name: 'stop', value: stop_id, type: 'number', notEmpty: true, optional: false }\n    ])\n\n    let buses = []\n    let stop_name = ''\n\n    return transitApi.retrieveStop(stop_id)\n        .then(response => {\n            const {features: [{ properties: { \"NOM_PARADA\": _stop_name } }] } = response\n            stop_name = _stop_name\n\n            return iBusApi.retrieveStopId(stop_id)\n        })\n        .then(response => {\n\n            const { data: { ibus } } = response\n\n            if (ibus.length === 0) throw new NoDataError('no data recived')\n\n            return ibus.map((bus, index) => {\n\n                const { line, \"t-in-min\": t_in_min, \"t-in-s\": t_in_s, \"text-ca\": text_ca } = bus\n\n                buses[index] = { line, t_in_min, t_in_s, text_ca }\n\n                return transitApi.retrieveBusLine()\n            })\n        })\n        .then(res => Promise.all(res).then(response => {\n            return response.map(({ features }) => {\n                return features.map(({ properties:\n                    { \"CODI_LINIA\": line_id,\n                        \"NOM_LINIA\": name_line,\n                        \"DESC_LINIA\": desc_line,\n                        \"ORIGEN_LINIA\": origin_line,\n                        \"DESTI_LINIA\": dest_line,\n                        \"COLOR_LINIA\": color_line\n                    }\n                }) => {\n                    return { line_id, name_line, desc_line, origin_line, dest_line, color_line }\n                })\n            })\n        })\n        )\n        .then(resp => {\n            let upcomingBuses = []\n            resp.map((arr, index) => {\n                let lineFind = false\n                let i = 0\n                let color_line = '#000000'\n                let dest_line = ''\n                let name_line = ''\n                let desc_line = ''\n                let origin_line = ''\n\n                while (i < arr.length && !lineFind) {\n                    if (arr[i].name_line === buses[index].line) {\n                        color_line  = arr[i].color_line\n                        dest_line   = arr[i].dest_line\n                        name_line   = arr[i].name_line\n                        desc_line   = arr[i].desc_line\n                        origin_line = arr[i].origin_line\n                        lineFind    = true\n                    }\n                    else { i++ }\n                }\n                upcomingBuses.push({ line: buses[index].line, \n                                     t_in_min: buses[index].t_in_min, \n                                     t_in_s: buses[index].t_in_s, \n                                     text_ca: buses[index].text_ca, \n                                     color_line, \n                                     dest_line, \n                                     name_line, \n                                     desc_line, \n                                     origin_line,\n                                     stop_id,\n                                     stop_name : stop_name\n                                }) \n\n            })\n            return upcomingBuses\n        })\n    },\n       \n\n\n    upcomingBusesByStopAndLine(stop_id, line_id) {\n\n        validate.arguments([\n            { name: 'stop', value: stop_id, type: 'number', notEmpty: true, optional: false },\n            { name: 'line', value: line_id, type: 'number', notEmpty: true, optional: false }\n        ])\n\n        let buses = []\n\n        let upcomingBuses = []\n\n        return iBusApi.retrieveLineId(stop_id, line_id)\n            .then(response => {\n\n                const { data: { ibus } } = response\n\n                if (ibus.length === 0) throw new NoDataError('no data recived')\n\n                return ibus.map((bus, index) => {\n\n                const {\"t-in-min\": t_in_min, \"t-in-s\": t_in_s, \"text-ca\": text_ca } = bus\n\n\n                buses[index] = { line_id, t_in_min, t_in_s, text_ca }\n\n                return transitApi.retrieveBusLine(line_id)\n                })\n            })\n            .then(res => Promise.all(res).then(response => {\n\n                return response.map(({features}) => {\n                    return features.map(({properties:\n                        { \"CODI_LINIA\"     : line_id,\n                            \"NOM_LINIA\"    : name_line,\n                            \"DESC_LINIA\"   : desc_line,\n                            \"ORIGEN_LINIA\" : origin_line,\n                            \"DESTI_LINIA\"  : dest_line,\n                            \"COLOR_LINIA\"  : color_line\n                        }\n                    }) => {return { line_id, name_line, desc_line, origin_line, dest_line, color_line } })\n                    }) \n                })  \n            )\n            .then(resp => {\n\n                resp.map((arr) => {\n                    upcomingBuses.push({ line        : buses[0].line_id, \n                                         t_in_min    : buses[0].t_in_min, \n                                         t_in_s      : buses[0].t_in_s, \n                                         text_ca     : buses[0].text_ca, \n                                         color_line  : arr[0].color_line, \n                                         dest_line   : arr[0].dest_line,\n                                         name_line   : arr[0].name_line, \n                                         desc_line   : arr[0].desc_line, \n                                         origin_line : arr[0].origin_line\n                     })\n                })\n                \n                return transitApi.retrieveStop(stop_id)\n            })\n            .then(response => {\n        \n                let busesData = []\n\n                const {features: [{ properties: { \"CODI_PARADA\": _stop_id, \"NOM_PARADA\": _stop_name } }] } = response\n\n                busesData.push({line        : upcomingBuses[0].line,\n                                t_in_min    : upcomingBuses[0].t_in_min, \n                                t_in_s      : upcomingBuses[0].t_in_s, \n                                text_ca     : upcomingBuses[0].text_ca, \n                                color_line  : upcomingBuses[0].color_line, \n                                dest_line   : upcomingBuses[0].dest_line,\n                                name_line   : upcomingBuses[0].name_line, \n                                desc_line   : upcomingBuses[0].desc_line, \n                                origin_line : upcomingBuses[0].origin_line,\n                                stop_id     : _stop_id,\n                                stop_name   : _stop_name\n                            })\n                return busesData\n                }\n                \n            )\n    }\n\n\n}\n\nexport default logic"]},"metadata":{},"sourceType":"module"}